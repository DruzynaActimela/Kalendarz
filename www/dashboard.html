@extends('template.html')
@section('title')
Dashboard
@stop
@section('content')
<div class='top-header'>
	<div class='th-logo left'>
		Kalendarz
	</div>

	<div class='dropdown right user-dropdown'>
		<div class='dropdown-block'>
			<div class='db-username left'>
				@yield('current_username', 'Aktualny użytkownik')
			</div>
			<div class='db-icon right'>
				<i class='fa fa-chevron-down'></i>
			</div>
			<div class='clear'></div>
		</div>
		<div class='dropdown-contextmenu'>
			<div class='dd-item'>
				<i class='fa fa-user dd-icon'></i>Profil
			</div>			
			<div class='dd-divider'></div>
			<a class='dd-item' href='/logout'>
				<i class='fa fa-sign-out dd-icon'></i>Wyloguj się
			</a>
		</div>
	</div>
	<div class='right'>
		<div class='button green no-label trigger-search'>
			<i class='fa fa-search'></i>
		</div>
		
		<div class='button green btn-add-event trigger-add-event'>
			<i class='fa fa-plus'></i>Dodaj zdarzenie
		</div>
	</div>
	<div class='clear'></div>
</div>

<div class="page-body columns-full-width">

	<div class="page-body-inner">
		<div class='left-panel left'>
			<div class='inner-panel-content'>
				<div class='left-menu-options'>
					<div class='lm-option lm-current screen-trigger' data-screen='calendar'>
						<i class='fa fa-calendar'></i>Kalendarz
					</div>
					<div class='lm-option screen-trigger' data-screen='events'>
						<i class='fa fa-calendar'></i>Zdarzenia
					</div>
					<div class='lm-option screen-trigger' data-screen='checklists'>
						<i class='fa fa-check-square-o'></i>Listy To-Do
					</div>

					<div class='lm-option screen-trigger' data-screen='settings'>
						<i class='fa fa-cogs'></i>Ustawienia
					</div>
					@isset('is_admin')
					Jest admin
					@else 
					Nie ma admina
					@endIsset
				</div>
			</div>
		</div>
		<div class='center-content left'>
			<div class='page-screen page-screen-first screen-calendar'>
				<div id='calendar'></div>
			</div>
			<div class='page-screen screen-events'>
				events
			</div>
			<div class='page-screen screen-checklists'>
				checklists
			</div>

			<div class='page-screen screen-settings'>
				settings
			</div>
		</div>
		<div class='right-panel left'>
			<div class='inner-panel-content'>
				<div>
					<div class='column-label'>
						Kalendarz
					</div>
					<div id="datepicker"></div>
				</div>
				<div class='column-widget'>
					<div class='column-label'>
						Twoje grupy zdarzeń
					</div>

					<div class='user-groups-list'>
					
					</div>
					<div class='widget-button trigger-add-group'>
						<i class='fa fa-plus'></i>Dodaj grupę
					</div>
				</div>
			</div>
		</div>
		<div class='clear'></div>
	</div>

</div>
<script>
	$(document).ready(function() {
		$('#calendar').fullCalendar({
			events: [
			{
				title: "Nazwa eventu",
				start: moment("2016-05-29 09:30").format(MOMENT_DATE_FORMAT_DAY_TIME),
				end: moment("2016-05-29 11:30").format(MOMENT_DATE_FORMAT_DAY_TIME)
			}
			],
			header: {
				left: 'prev,next today',
				center: 'title',
				right: 'month,agendaWeek,agendaDay'
			},
			editable: true,
			eventLimit: true,
			timeFormat: 'H(:mm)',
			firstDay: 1,
			eventRender: function(event, element) {

		    },
		    nowIndicator: true,
			events: function(start, end, timezone, callback) {
		        $.ajax({
		            url: '/api/events',
		            dataType: 'json',
		            data: {
		                start: start.unix(),
		                end: end.unix()
		            },
		            success: function(json) {
		                var events = [];
		                for(var i in json) {
		                	var evt = json[i];
		                	console.log(evt);
		                	events.push({
		                        title: evt.title,
		                        start: moment.unix(json.start),
		                        end: moment.unix(json.end)
		                    });
		                }
		                callback(events);
		            }
		        });
			}
    });
		$( "#datepicker" ).datepicker({
			showOtherMonths: true,
			firstDay: 1
		});
	});
</script>
@stop